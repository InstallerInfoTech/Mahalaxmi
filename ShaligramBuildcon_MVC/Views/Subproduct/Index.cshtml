
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="panel panel-white">
    <div class="panel-heading">
        <h5 class="panel-title">
            Products
        </h5>
    </div>
    <div class="panel-body">
        @(Html.Kendo().Grid<ShaligramBuildcon_MVC.Models.Sub_Product>()
                                    .Name("subproductgrid")
                                    .Columns(columns =>
                                    {
                                        columns.Command(command => { command.Edit().Text(" ").HtmlAttributes(new { title = "Add/Edit Products" }); command.Destroy().Text(" ").HtmlAttributes(new { title = "Delete Products" }); }).Width(120).Title("Action");
                                        
                                        columns.Bound(m => m.Name).Title("Sub Product Name");//.Width(50);
                                        columns.Bound(m => m.Description).Title("Description");
                                        columns.Bound(m => m.SKU).Title("SKU");
                                        

                                        columns.ForeignKey(p => p.Location_id, (System.Collections.IEnumerable)ViewData["Location"], "Location_id", "Name").Title("Location");
                                        columns.Bound(m => m.Labour_rate).Title("Labour Rate");


                                    })
                                     .ToolBar(toolbar => toolbar.Template("<a id='btnAdd' class='k-button k-button-icontext k-grid-add' href='#'><span class='k-icon k-add'></span>+Add New Subproducts</a><a id='btnAddRawMaterial'  class='k-button k-button-icontext' href='#'><span class='k-icon k-add'></span>Add Raw Materials</a>")
                                    )
            .Editable(editable => editable.Mode(GridEditMode.InLine).ConfirmDelete("Continue to delete this record?").DisplayDeleteConfirmation("Continue to delete this record?"))
            .Excel(excel => excel
            .AllPages(true)
            .Filterable(true)
            .FileName("Inquiry.xlsx")
            .ProxyURL(Url.Action("Excel_Export_Save", "Inquiry"))
            )
            //.Editable(editable =>
            //.Resizable(r => r.Columns(true))
            .Pageable(x =>
            {
                x.Refresh(true);
                x.PageSizes(CommonHelper.LargePageSizes);
            })
            .Editable(editable =>
            {
                editable.Mode(GridEditMode.InLine);
                editable.DisplayDeleteConfirmation("Are you sure you want to delete this Category?");//"Are you sure you want to delete this Category?"

            })
            .Filterable(ftb => ftb.Mode(GridFilterMode.Row))
            .Sortable(sortable => sortable.AllowUnsort(false))
            .Scrollable(s => s.Height("auto"))
            .NoRecords()
             .ClientDetailTemplateId("client-template")
            //.Events(grid => grid.DataBound("onDataBoundEdit"))
            .DataSource(dataSource => dataSource
            .Ajax()
            .ServerOperation(false)
            .PageSize(CommonHelper.PazeSize)
            .Events(events => events.Error("onError(\"InquiryGrid\")"))
            .Model(model => model.Id(d => d.SubProduct_Id))
            .Create(update => update.Action("KendoSave", "SubProduct"))
            .Read(read => read.Action("KendoRead", "SubProduct"))
            .Update(update => update.Action("KendoSave", "SubProduct"))
            .Destroy(destroy => destroy.Action("kendoDestroy", "SubProduct")))

            )


    </div>

    <script id="client-template" type="text/kendo-tmpl">
        @(Html.Kendo().Grid<ShaligramBuildcon_MVC.Models.Subproduct_RM_usage>()
                                    .Name("grid_#=SubProduct_Id#")
                                    .Columns(columns =>
                                    {
                                        columns.Command(command => { command.Edit().Text(" ").HtmlAttributes(new { title = "Edit Payment Plan" }); command.Destroy().Text(" ").HtmlAttributes(new { title = "Delete Payment Plan" }); }).Width(100).Title("Action");

                                        columns.ForeignKey(p => p.Rawmaterial_id, (System.Collections.IEnumerable)ViewData["RM"], "Rawmaterial_Id", "Name").Title("Raw Material");
                                        columns.Bound(m => m.Required_qty).Title("Required Qty");//.Width(50);
                                        columns.Bound(m => m.Subproduct_id).Visible(false);//.Width(50);




                                    })
            .ToolBar(toolbar => toolbar.Create().Text("Add Raw Material Relation"))

            .Editable(editable => editable.Mode(GridEditMode.InLine).ConfirmDelete("Continue to delete this record?").DisplayDeleteConfirmation("Continue to delete this record?"))
            .Excel(excel => excel
            .AllPages(true)
            .Filterable(true)
            .FileName("Inquiry.xlsx")
            .ProxyURL(Url.Action("Excel_Export_Save", "Inquiry"))
            )
            //.Editable(editable =>
            //.Resizable(r => r.Columns(true))
            //.Pageable(x =>
            //{
            //    x.Refresh(true);
            //    x.PageSizes(CommonHelper.LargePageSizes);
            //})
            //.Editable(editable =>
            //{
            //    editable.Mode(GridEditMode.InLine);
            //    editable.DisplayDeleteConfirmation("Are you sure you want to delete this Category?");//"Are you sure you want to delete this Category?"

            //})
            //.Filterable(ftb => ftb.Mode(GridFilterMode.Row))

            //.Sortable(sortable => sortable.AllowUnsort(false))
            //.Scrollable(s => s.Height("auto"))
            .NoRecords()
             //.Events(grid => grid.DataBound("onDataBoundEdit"))

            .DataSource(dataSource => dataSource
            .Ajax()
            .ServerOperation(false)
            .PageSize(CommonHelper.PazeSize)
            .Events(events => events.Error("onError(\"InquiryGrid\")"))
            .Model(model => model.Id(d => d.Rawmaterial_id))
             .Create(update => update.Action("SaveSubProductChild", "SubProduct"))
            .Read(read => read.Action("ReadrealtionGrid", "SubProduct" , new { SubProduct_Id = "#=SubProduct_Id#" }))
            .Update(update => update.Action("SaveSubProductChild", "SubProduct"))
            .Destroy(destroy => destroy.Action("DeleteSubProductChild", "SubProduct").Data("GetPRMID")))

            .ToClientTemplate()


            )

       

    </script>




    @(Html.Kendo().Window()
                          .Name("rawmaterials")
                          .Draggable(true)
                          .Width(870)
                          .Height(520)
                          .Scrollable(true)
                          .Modal(true)
                          .Visible(false)
)

</div>



@(Html.Kendo().Window()
                          .Name("rawmaterials")
                          .Draggable(true)
                          .Width(870)
                          .Height(520)
                          .Scrollable(true)
                          .Modal(true)
                          .Visible(false)
)

<script>
    function GetPRMID(e) {

        return {
            PRMID: e.SPRM_id

        }
    }

    function GetPSRID(e) {

        return {
            PRSID: e.PSR_id

        }
    }
</script>

